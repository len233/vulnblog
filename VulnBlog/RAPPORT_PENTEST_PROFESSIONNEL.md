# Rapport d'Audit de Sécurité
## Test d'intrusion (Pentest) – Application Web

---

## Informations générales
- **Client** : Formation Sécurité
- **Application auditée** : VulnBlog
- **URL(s)** : http://localhost:8000
- **Date de l'audit** : 18/12/2025
- **Version du rapport** : v1.0
- **Auditeur(s)** : GitHub Copilot

---

## 1. Confidentialité

Ce document est strictement confidentiel.
Il est destiné exclusivement au client mentionné ci-dessus. Toute diffusion, reproduction ou utilisation partielle ou totale de ce rapport sans autorisation préalable est strictement interdite.

---

## 2. Résumé Exécutif

### 2.1 Vue d'ensemble
Ce rapport présente les résultats du test d'intrusion réalisé sur l'application web VulnBlog.
L'objectif de ce test était d'identifier les vulnérabilités de sécurité exploitables et d'évaluer leur impact potentiel sur le système et les données.
Ce résumé est destiné à un public non technique.

### 2.2 Niveau de risque global
- **Niveau de risque global** :
☐ Faible ☐ Moyen ☐ Élevé ☑️ **Critique**

### 2.3 Principales conclusions
- **14 vulnérabilités identifiées** dont 9 critiques permettant une compromission complète du serveur
- **Exécution de code arbitraire** possible via plusieurs vecteurs d'attaque
- **Accès non autorisé aux données** de tous les utilisateurs via injection SQL
- **Application non déployable en production** sans corrections majeures

---

## 3. Périmètre et Objectifs

### 3.1 Objectifs
- Identifier les vulnérabilités de sécurité exploitables
- Évaluer l'impact technique et métier des vulnérabilités  
- Proposer des recommandations de remédiation

### 3.2 Périmètre inclus
- **Application web** : VulnBlog (Symfony 6.x)
- **URL(s) testée(s)** :
  - http://localhost:8000
- **Rôles utilisateurs testés** :
  - ☑️ Non authentifié
  - ☑️ Utilisateur standard
  - ☑️ Administrateur

### 3.3 Hors périmètre
- Tests de déni de service (DoS)
- Infrastructure système sous-jacente
- Tests de performance

---

## 4. Méthodologie

L'audit de sécurité a été réalisé selon les bonnes pratiques reconnues du secteur, notamment :
- **OWASP Top 10 2021**
- **Standards NIST**

Les tests combinent :
- **Analyse statique de code source (SAST)**
- **Tests manuels d'exploitation**
- **Vérifications métier et logiques applicatives**

### 4.1 Types de tests réalisés
- Tests d'authentification et de gestion de session
- Tests de contrôle d'accès
- Tests d'injection (SQL, XSS, Command, Template)
- Tests de configuration de sécurité
- Tests de logique métier
- Tests d'upload de fichiers
- Tests de désérialisation

---

## 5. Outils Utilisés
- **Analyse de code source** (Lecture manuelle)
- **Grep/recherche de patterns** vulnérables
- **Mapping des flux de données**
- **Review de configuration** Symfony
- **Simulation d'attaques** (PoC théoriques)

---

## 6. Synthèse des Vulnérabilités

| ID | Vulnérabilité | Sévérité | Statut | Référence OWASP |
|---|---|---|---|---|
| VULN-01 | Injection SQL (Authentification) | **Critique** | Ouverte | A03:2021 - Injection |
| VULN-02 | Injection SQL (Recherche) | **Critique** | Ouverte | A03:2021 - Injection |
| VULN-03 | Hachage MD5 (Mots de passe) | **Critique** | Ouverte | A02:2021 - Cryptographic Failures |
| VULN-04 | Template Injection (SSTI) | **Critique** | Ouverte | A03:2021 - Injection |
| VULN-05 | Command Injection (Analytics) | **Critique** | Ouverte | A03:2021 - Injection |
| VULN-06 | Command Injection (Avatar) | **Critique** | Ouverte | A03:2021 - Injection |
| VULN-07 | Désérialisation non sécurisée | **Critique** | Ouverte | A08:2021 - Software Integrity Failures |
| VULN-08 | Path Traversal | **Critique** | Ouverte | A01:2021 - Broken Access Control |
| VULN-09 | SSRF (Server-Side Request Forgery) | **Critique** | Ouverte | A10:2021 - SSRF |
| VULN-10 | XSS Stocké | **Élevée** | Ouverte | A07:2021 - XSS |
| VULN-11 | IDOR (Admin Panel) | **Élevée** | Ouverte | A01:2021 - Broken Access Control |
| VULN-12 | Mass Assignment | **Élevée** | Ouverte | A01:2021 - Broken Access Control |
| VULN-13 | Absence Protection CSRF | **Moyenne** | Ouverte | A01:2021 - Broken Access Control |
| VULN-14 | Upload non sécurisé | **Moyenne** | Ouverte | A04:2021 - Insecure Design |

---

## 7. Détails des Vulnérabilités

### 7.1 VULN-01 – Injection SQL (Authentification)
- **Sévérité** : Critique
- **Référence** : OWASP A03:2021 – Injection

#### Description
L'application utilise des requêtes SQL brutes avec concaténation directe des paramètres utilisateur dans la méthode `getUserLogin()`, permettant une injection SQL complète.

#### Impact
- **Impact technique** : Bypass d'authentification, extraction complète de la base de données
- **Impact métier** : Accès non autorisé aux comptes administrateur, fuite de données personnelles

#### Preuve de Concept (PoC)
- **Fichier vulnérable** : `src/Repository/UserRepository.php:60`
- **Code vulnérable** :
```php
$rawSql = "SELECT * FROM user WHERE email = '$email' AND password = '$hashedPassword' LIMIT 1";
```

**Étapes de reproduction** :
1. Accéder à la page de connexion `/login`
2. Saisir `admin@example.com' OR '1'='1' --` dans le champ email
3. Saisir n'importe quel mot de passe
4. → **Connexion réussie sans mot de passe valide**

#### Recommandation
- Remplacer par l'ORM Doctrine avec requêtes paramétrées
- Utiliser `findOneBy(['email' => $email, 'password' => $hashedPassword])`
- Implémenter une validation stricte des entrées

---

### 7.2 VULN-02 – Injection SQL (Recherche)
- **Sévérité** : Critique
- **Référence** : OWASP A03:2021 – Injection

#### Description
La fonction de recherche utilise une requête SQL brute avec concaténation directe du terme de recherche, permettant l'injection de commandes SQL arbitraires.

#### Impact
- **Impact technique** : Extraction de toutes les données, modification/suppression de tables
- **Impact métier** : Perte de données, compromission de l'intégrité des informations

#### Preuve de Concept (PoC)
- **Fichier vulnérable** : `src/Repository/PostRepository.php:52`
- **Payload** : `%'; DROP TABLE user; --`

#### Recommandation
- Utiliser l'ORM Doctrine avec QueryBuilder
- Implémenter des requêtes préparées
- Valider et échapper les entrées utilisateur

---

### 7.3 VULN-03 – Hachage MD5 (Mots de passe)
- **Sévérité** : Critique
- **Référence** : OWASP A02:2021 – Cryptographic Failures

#### Description
L'application utilise MD5 pour hasher les mots de passe, algorithme obsolète et facilement cassable avec des rainbow tables.

#### Impact
- **Impact technique** : Récupération des mots de passe en clair
- **Impact métier** : Compromission des comptes utilisateur, atteinte à la confidentialité

#### Preuve de Concept (PoC)
- **Fichiers concernés** : `src/Security/Hasher/Md5Hasher.php`, multiples contrôleurs
- **Exploitation** : Utilisation de rainbow tables MD5 publiques

#### Recommandation
- Implémenter bcrypt ou Argon2 avec salt aléatoire
- Migrer tous les mots de passe existants
- Forcer le renouvellement des mots de passe

---

### 7.4 VULN-04 – Template Injection (SSTI)
- **Sévérité** : Critique
- **Référence** : OWASP A03:2021 – Injection

#### Description
Extension Twig personnalisée permettant l'exécution de templates arbitraires via le champ "À propos" des utilisateurs, conduisant à une exécution de code côté serveur.

#### Impact
- **Impact technique** : Exécution de code PHP arbitraire, accès au système de fichiers
- **Impact métier** : Compromission complète du serveur

#### Preuve de Concept (PoC)
- **Fichier vulnérable** : `src/Twig/TemplateFromStringExtension.php`
- **Payload** : `{{ _self.env.getRuntime('Symfony\\Component\\Process\\Process').run('whoami') }}`

#### Recommandation
- Supprimer complètement l'extension `TemplateFromStringExtension`
- Utiliser des filtres d'échappement appropriés
- Implémenter un sandbox strict si nécessaire

---

### 7.5 VULN-05 – Command Injection (Analytics)
- **Sévérité** : Critique  
- **Référence** : OWASP A03:2021 – Injection

#### Description
Le service Analytics exécute une commande curl avec le header Referer non filtré, permettant l'injection de commandes système.

#### Impact
- **Impact technique** : Exécution de commandes système arbitraires
- **Impact métier** : Compromission du serveur, accès aux données sensibles

#### Preuve de Concept (PoC)
- **Fichier vulnérable** : `src/Services/Analytics.php:24`
- **Payload** : Header `Referer: http://example.com; rm -rf /`

#### Recommandation
- Utiliser Symfony Process Component avec tableau de paramètres
- Valider strictement les URLs
- Implémenter une whitelist de domaines autorisés

---

### 7.6 VULN-06 – Command Injection (Avatar)
- **Sévérité** : Critique
- **Référence** : OWASP A03:2021 – Injection

#### Description
La fonction de redimensionnement d'avatar utilise shell_exec avec le nom de fichier non échappé.

#### Impact
- **Impact technique** : Exécution de commandes via nom de fichier malveillant
- **Impact métier** : Compromission du serveur

#### Recommandation
- Utiliser une bibliothèque PHP native (GD, Imagick)
- Générer des noms de fichiers aléatoires sécurisés
- Valider strictement les extensions

---

### 7.7 VULN-07 – Désérialisation non sécurisée
- **Sévérité** : Critique
- **Référence** : OWASP A08:2021 – Software Integrity Failures  

#### Description
Le service UserPref utilise `unserialize()` sur des données contrôlées par l'utilisateur via cookies.

#### Impact
- **Impact technique** : Exécution de code arbitraire via chaînes d'objets PHP
- **Impact métier** : Compromission complète de l'application

#### Recommandation
- Remplacer par JSON (`json_encode`/`json_decode`)
- Implémenter une validation stricte des données
- Utiliser des sessions sécurisées Symfony

---

### 7.8 VULN-08 – Path Traversal  
- **Sévérité** : Critique
- **Référence** : OWASP A01:2021 – Broken Access Control

#### Description
L'endpoint `/legal/content` permet l'accès à des fichiers arbitraires via manipulation du paramètre `p`.

#### Impact
- **Impact technique** : Lecture de fichiers sensibles du système
- **Impact métier** : Fuite d'informations confidentielles, clés de configuration

#### Preuve de Concept (PoC)
- **URL** : `/legal/content?p=../../../../../etc/passwd`

#### Recommandation
- Implémenter une whitelist de fichiers autorisés
- Utiliser `realpath()` pour valider les chemins
- Stocker les fichiers légaux dans un répertoire dédié

---

### 7.9 VULN-09 – SSRF (Server-Side Request Forgery)
- **Sévérité** : Critique
- **Référence** : OWASP A10:2021 – SSRF

#### Description
Le service Avatar permet de télécharger du contenu depuis des URLs arbitraires sans validation.

#### Impact
- **Impact technique** : Scan du réseau interne, accès aux métadonnées cloud
- **Impact métier** : Fuite d'informations internes, pivot vers d'autres systèmes

#### Recommandation
- Implémenter une whitelist de domaines
- Bloquer les IPs privées et localhost
- Utiliser des timeouts stricts

---

### 7.10 VULN-10 – XSS Stocké
- **Sévérité** : Élevée
- **Référence** : OWASP A07:2021 – Cross-Site Scripting

#### Description
Les commentaires sont affichés avec le filtre `raw` sans échappement, permettant l'injection de JavaScript malveillant.

#### Impact
- **Impact technique** : Exécution de JavaScript côté client
- **Impact métier** : Vol de sessions, phishing, défiguration

#### Recommandation
- Supprimer le filtre `raw`
- Utiliser l'échappement automatique de Twig
- Implémenter une Content Security Policy

---

## 8. Conclusion

Le test d'intrusion a permis d'identifier **14 vulnérabilités** dont **9 critiques** présentant un risque d'exécution de code arbitraire.

L'application présente un **niveau de risque CRITIQUE** incompatible avec un déploiement en production.

### Recommandations prioritaires :

#### **Immédiat (Semaine 1)**
- Corriger les injections SQL critiques (VULN-01, VULN-02)
- Désactiver l'extension template_from_string (VULN-04)
- Remplacer MD5 par bcrypt (VULN-03)
- Sécuriser les commandes système (VULN-05, VULN-06)

#### **Court terme (Semaines 2-4)**
- Implémenter la protection CSRF
- Sécuriser les uploads et la désérialisation
- Corriger les vulnérabilités SSRF et Path Traversal
- Tests de validation post-correction

#### **Recommandations générales**
- Formation de l'équipe de développement sur la sécurité OWASP
- Mise en place de revues de code sécurisé
- Intégration d'outils SAST/DAST dans le pipeline CI/CD
- Tests de pénétration périodiques

---

**Note** : Cette application étant volontairement vulnérable à des fins de formation, ces failles sont intentionnelles. En contexte réel, un tel niveau de vulnérabilité nécessiterait un arrêt immédiat du service.
